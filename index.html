<!DOCTYPE html>
<html>
<head>
<title>üî• Drake AI Smart Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:black;
  color:#00ffff;
  font-family:Arial;
  padding:20px;
}

#chat{
  height:60vh;
  overflow-y:auto;
  border:2px solid #00ffff;
  padding:10px;
}

.msg{margin:6px 0;}
.user{color:#00ff88;}
.ai{color:#00ccff;}
.error{color:red;}

#status{
  margin-top:10px;
  font-weight:bold;
}
</style>
</head>
<body>

<h2>üî• Drake AI ‚Äî Auto Wake System</h2>

<div id="chat"></div>
<div id="status">Status: Idle (Waiting for "Drake")</div>

<script>

const API_KEY = "ddc-a4f-c964629239ac4b1eba7b5a8a57e94a38";

let recognition;
let mode = "idle"; // idle | command
let processing = false;

function log(msg,type="info"){
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "msg " + type;
  div.innerText = msg;

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function updateStatus(text){
  document.getElementById("status").innerText = "Status: " + text;
}

function startListening(){

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.continuous = true;
  recognition.interimResults = false;

  recognition.start();
  updateStatus("Listening for Wake Word...");

  recognition.onresult = async function(event){

    if(processing) return;

    const textRaw = event.results[event.results.length - 1][0].transcript;
    const text = textRaw.toLowerCase();

    log("üó£ Heard: " + text,"user");

    // ---------- IDLE MODE ----------
    if(mode === "idle"){

      if(text.includes("drake") || text.includes("drak") || text.includes("draik")){

        mode = "command";
        updateStatus("Wake detected ‚Äî Listening for Command");
        speak("Yes boss?");
      }

    }

    // ---------- COMMAND MODE ----------
    else if(mode === "command"){

      processing = true;

      recognition.stop(); // stop mic temporarily

      if(text.includes("play")){
        const song = text.replace("play","").trim();
        playSong(song);
      }
      else{
        await askAI(text);
      }

      // After response ‚Üí go back to idle
      mode = "idle";
      updateStatus("Idle (Waiting for 'Drake')");

      setTimeout(()=>{
        recognition.start();
      },1500);

      processing = false;
    }

  };

  recognition.onerror = function(e){
    log("Mic Error: " + e.error,"error");
    recognition.stop();
    setTimeout(()=>recognition.start(),1000);
  };
}

async function askAI(text){

  log("ü§ñ Sending to AI...");

  try{

    const res = await fetch("https://api.a4f.co/v1/chat/completions",{
      method:"POST",
      headers:{
        "Authorization":"Bearer " + API_KEY,
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        model:"provider-6/gpt-oss-20b",
        messages:[
          {role:"system",content:"You are Drake AI. Reply short and smart."},
          {role:"user",content:text}
        ],
        temperature:0.7,
        max_tokens:300
      })
    });

    const data = await res.json();

    if(!data.choices){
      log("‚ùå API Error: " + JSON.stringify(data),"error");
      return;
    }

    const reply = data.choices[0].message.content;

    log("ü§ñ Drake: " + reply,"ai");
    speak(reply);

  }catch(err){
    log("‚ùå Network Error","error");
  }
}

function speak(text){
  const speech = new SpeechSynthesisUtterance(text);
  speech.lang = "en-US";
  speech.rate = 1;
  window.speechSynthesis.speak(speech);
}

function playSong(song){

  log("üéµ Playing: " + song);
  speak("Playing " + song);

  const url = "https://www.youtube.com/results?search_query=" +
    encodeURIComponent(song + " official audio");

  window.open(url,"_blank");
}

window.onload = startListening;

</script>

</body>
</html>

