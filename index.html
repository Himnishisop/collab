<!DOCTYPE html>
<html>
<head>
<title>ðŸ”¥ Drake AI - Real Wake Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@picovoice/porcupine-web@latest/dist/iife/index.js"></script>

<style>
body{
  background:black;
  color:#00ffff;
  font-family:Arial;
  padding:20px;
}
#log{
  height:80vh;
  overflow:auto;
  border:2px solid #00ffff;
  padding:10px;
}
.msg{margin:6px 0;}
.wake{color:lime;}
</style>
</head>
<body>

<h2>ðŸ”¥ Drake AI â€” Real Wake Word Engine</h2>

<div id="log"></div>

<script>

const ACCESS_KEY = "8LcymlmIi9K8+h25/5bGVTTC997LahCxBkQ4NwdYxXCa6hp6j9QDVA=="; 
// Get from Picovoice dashboard

let porcupine;
let audioContext;
let microphone;

function log(msg,type="info"){
  const div = document.createElement("div");
  div.className="msg "+type;
  div.innerText=msg;
  document.getElementById("log").appendChild(div);
  document.getElementById("log").scrollTop =
    document.getElementById("log").scrollHeight;
}

async function startEngine(){

  log("ðŸ§  Loading Porcupine...");

  porcupine = await PorcupineWeb.PorcupineWorker.create(
    ACCESS_KEY,
    ["drake.ppn"], // YOUR MODEL FILE
    [0.5] // Sensitivity
  );

  porcupine.onmessage = (event)=>{
    if(event.data.keywordIndex === 0){
      log("ðŸ”¥ WAKE WORD DETECTED â€” Drake","wake");
      speak("Yes boss?");
      listenForCommand();
    }
  };

  log("ðŸŽ¤ Starting microphone...");

  audioContext = new AudioContext();
  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  microphone = audioContext.createMediaStreamSource(stream);

  const processor = audioContext.createScriptProcessor(512,1,1);

  microphone.connect(processor);
  processor.connect(audioContext.destination);

  processor.onaudioprocess = (e)=>{
    const input = e.inputBuffer.getChannelData(0);
    porcupine.postMessage({command:"process", input});
  };

  log("âœ… Drake Wake Engine Running");
}

function listenForCommand(){
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang="en-US";
  recognition.start();

  recognition.onresult = async (event)=>{
    const command = event.results[0][0].transcript;
    log("ðŸ§  Command: "+command);
    handleCommand(command);
  };
}

function handleCommand(text){

  if(text.includes("play")){
    const song = text.replace("play","").trim();
    playSong(song);
  }
  else{
    speak("Processing");
  }
}

function playSong(song){
  log("ðŸŽµ Playing "+song);
  window.open(
    "https://www.youtube.com/results?search_query="+
    encodeURIComponent(song+" official audio"),
    "_blank"
  );
}

function speak(text){
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang="en-US";
  window.speechSynthesis.speak(utter);
}

startEngine();

</script>

</body>
</html>
