<!DOCTYPE html>
<html>
<head>
<title>üî• Drake AI Stable</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    background:black;
    color:#00ffff;
    font-family:Arial;
    padding:20px;
}
#chat{
    height:60vh;
    overflow-y:auto;
    border:2px solid #00ffff;
    padding:10px;
}
.msg{ margin:6px 0; }
.user{color:#00ff88;}
.ai{color:#00ccff;}
.error{color:red;}
#debug{
    margin-top:10px;
    height:20vh;
    overflow-y:auto;
    border:1px solid red;
    padding:5px;
    font-size:12px;
}
</style>
</head>
<body>

<h2>üî• Drake AI ‚Äì Stable</h2>

<div id="chat"></div>
<h3>üêû Debug</h3>
<div id="debug"></div>

<script>

const API_KEY = "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";

let recognition;
let waitingForCommand = false;
let processing = false;

function log(msg,type="info"){
    const chat = document.getElementById("chat");
    const div = document.createElement("div");
    div.className = "msg " + type;
    div.innerText = msg;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;

    const debug = document.getElementById("debug");
    debug.innerHTML += msg + "<br>";
    debug.scrollTop = debug.scrollHeight;
}

function startMic(){

    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "en-US";
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.maxAlternatives = 5;

    recognition.start();
    log("üé§ Listening for 'Drake'...");

    recognition.onresult = async function(event){

        if(processing) return;

        const textRaw = event.results[event.results.length - 1][0].transcript;
        const text = textRaw.toLowerCase();

        log("üó£ Heard: " + text,"user");

        if(!waitingForCommand){

            // ---- WAKE WORD DETECTION ----
            if(text.includes("drake") || text.includes("draik") || text.includes("drak")){

                log("‚úÖ Wake word detected","ai");

                waitingForCommand = true;

                speak("Yes boss?");

                // Stop mic temporarily
                recognition.stop();

                // After short delay, restart to capture command
                setTimeout(()=>{
                    recognition.start();
                },1000);
            }

        } else {

            // ---- COMMAND MODE ----
            waitingForCommand = false;

            if(text.includes("play")){
                const song = text.replace("play","").trim();
                playSong(song);
            }
            else{
                await askAI(text);
            }
        }
    };

    recognition.onerror = function(e){
        log("Mic Error: " + e.error,"error");
        recognition.stop();
        setTimeout(()=>recognition.start(),1000);
    };
}

async function askAI(text){

    log("ü§ñ Sending to AI...");

    try{

        const res = await fetch("https://openrouter.ai/api/v1/chat/completions",{
            method:"POST",
            headers:{
                "Authorization":"Bearer " + API_KEY,
                "Content-Type":"application/json"
            },
            body:JSON.stringify({
                model:"liquid/lfm-2.5-1.2b-thinking:free",
                messages:[
                    {role:"system",content:"You are Drake AI. Reply short."},
                    {role:"user",content:text}
                ]
            })
        });

        const data = await res.json();

        if(!data.choices){
            log("‚ùå API Error","error");
            return;
        }

        const reply = data.choices[0].message.content;

        log("ü§ñ Drake: " + reply,"ai");
        speak(reply);

    }catch(err){
        log("‚ùå Network Error","error");
    }
}

function speak(text){
    const speech = new SpeechSynthesisUtterance(text);
    speech.lang = "en-US";
    speech.rate = 1;
    window.speechSynthesis.speak(speech);
}

function playSong(song){
    log("üéµ Playing: " + song);

    const url = "https://www.youtube.com/results?search_query=" +
        encodeURIComponent(song + " official audio");

    window.open(url,"_blank");
}

window.onload = startMic;

</script>

</body>
</html>
